@*
 * Copyright 2020 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import play.api.i18n._
@import forms.TaxResult._
@import uk.gov.hmrc.calculator.model.CalculatorResponsePayPeriod
@import config.AppConfig

@this(govukPanel: GovukPanel,
        govukSummaryList: GovukSummaryList,
        govukTable: GovukTable,
        govukDetails: GovukDetails,
        govButton: GovukButton,
        p: components.p,
        h3: components.h3,
        h2: components.h2,
        linkNewTab: components.linkNewTab,
        appConfig: AppConfig
)


@(calculatorResponse: CalculatorResponsePayPeriod, taxYear: Int, label: String, isKCode: Boolean)(implicit request: Request[_], messages: Messages)

@govukPanel(Panel(
    headingLevel = 0,
    content = HtmlContent(s"${Messages("quick_calc.result.you_take_home")} $taxYear is <br><strong>£${moneyFormatter(calculatorResponse.getTakeHome)} ${Messages("a")} ${label.toLowerCase}</strong>")
))

<br/>

@h2(Messages("quick_calc.result.total_deductions.info"))

@govukSummaryList(
    SummaryList(
        rows = Seq(
            SummaryListRow(
                key = Key(content = Text(if(isKCode) Messages("quick_calc.result.income_tax_adjusted") else Messages("quick_calc.result.income_tax")),
                    classes = "govuk-!-font-weight-regular"),
                value = Value(content = Text(s"£${moneyFormatter(extractIncomeTax(calculatorResponse))}")
                )
            ),
            SummaryListRow(
                key = Key(content = Text(Messages("quick_calc.result.your_national_insurance")),
                    classes = "govuk-!-font-weight-regular"),
                value = Value(content = Text(s"£${moneyFormatter(calculatorResponse.getEmployeesNI)}"),

                )
            ),
            SummaryListRow(
                key = Key(content = HtmlContent(Messages("quick_calc.result.deductions"))),
                value = Value(content = HtmlContent("<strong>" + s"£${moneyFormatter(calculatorResponse.getTotalDeductions)}" + "</strong>")
                )
            )
        )
    )
)


@if(calculatorResponse.getMaxTaxAmountExceeded) {
    @h3(Messages("quick_calc.result.adjusted.head"))
    @p {
        @Messages("quick_calc.result.adjusted.info")
    }
}

@if(isKCode) {
    @p {
        @Messages("quick_calc.about_k_code_a")
        @linkNewTab("https://www.gov.uk/tax-codes/letters-in-your-tax-code-what-they-mean", Messages("quick_calc.about_k_code_b_k"))
        @Messages("quick_calc.about_k_code_c")
    }

    @h2(Messages("quick_calc.result.how_we_calculated"))

    @govukSummaryList(
        SummaryList(
            rows = Seq(
                SummaryListRow(
                    key = Key(content = Text(Messages("quick_calc.result.how_we_calculated.you_earn_a")),
                        classes = "govuk-!-font-weight-regular"),
                    value = Value(content = Text(s"£${moneyFormatter(calculatorResponse.getWages)} ${Messages("quick_calc.result.how_we_calculated.you_earn_b")}")
                    )
                ),
                SummaryListRow(
                    key = Key(content = Text(Messages("quick_calc.result.k_code")),
                        classes = "govuk-!-font-weight-regular"),
                    value = Value(content = Text(s"£${moneyFormatter(calculatorResponse.getKCodeAdjustment.doubleValue())}")
                    )
                )
                ,
                SummaryListRow(
                    key = Key(content = Text(Messages("quick_calc.result.tax_free_allowance")),
                        classes = "govuk-!-font-weight-regular"),
                    value = Value(content = Text(s"£${moneyFormatter(calculatorResponse.getTaxFree)}")
                    )
                ),
                SummaryListRow(
                    key = Key(content = HtmlContent(Messages(if(isKCode) "quick_calc.result.adjusted_taxable_pay" else "quick_calc.result.taxable_pay"))),
                    value = Value(content = HtmlContent("<strong>" + s"£${
                        moneyFormatter(if(calculatorResponse.getWages - calculatorResponse.getTaxFree < 0) {
                            0
                        } else {
                            if(isKCode) {
                                calculatorResponse.getWages + calculatorResponse.getKCodeAdjustment
                            } else {
                                calculatorResponse.getWages - calculatorResponse.getTaxFree
                            }
                        })
                    }" + "</strong>")
                    )
                )
            )
        )
    )
} else {

    @h2(Messages("quick_calc.result.how_we_calculated"))

    @govukSummaryList(
        SummaryList(
            rows = Seq(
                SummaryListRow(
                    key = Key(content = Text(Messages("quick_calc.result.how_we_calculated.you_earn_a")),
                        classes = "govuk-!-font-weight-regular"),
                    value = Value(content = Text(s"£${moneyFormatter(calculatorResponse.getWages)} ${Messages("quick_calc.result.how_we_calculated.you_earn_b")}")
                    )
                ),
                SummaryListRow(
                    key = Key(content = Text(Messages("quick_calc.result.tax_free_allowance")),
                        classes = "govuk-!-font-weight-regular"),
                    value = Value(content = Text(s"£${moneyFormatter(calculatorResponse.getTaxFree)}")
                    )
                ),
                SummaryListRow(
                    key = Key(content = HtmlContent(Messages(if(isKCode) "quick_calc.result.adjusted_taxable_pay" else "quick_calc.result.taxable_pay"))),
                    value = Value(content = HtmlContent("<strong>" + s"£${
                        moneyFormatter(if(calculatorResponse.getWages - calculatorResponse.getTaxFree < 0) {
                            0
                        } else {
                            if(isKCode) {
                                calculatorResponse.getWages + calculatorResponse.getKCodeAdjustment
                            } else {
                                calculatorResponse.getWages - calculatorResponse.getTaxFree
                            }
                        })
                    }" + "</strong>")
                    )
                )
            )
        )
    )
}


