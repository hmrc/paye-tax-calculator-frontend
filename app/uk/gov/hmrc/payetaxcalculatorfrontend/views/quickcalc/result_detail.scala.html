@*
 * Copyright 2019 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import play.api.i18n._
@import uk.gov.hmrc.payetaxcalculatorfrontend.quickmodel.TaxResult._
@import uk.gov.hmrc.payetaxcalculatorfrontend.quickmodel.QuickCalcAggregateInput

@import uk.gov.hmrc.calculator.model.CalculatorResponse
@(calculatorResponse: CalculatorResponse, taxYear: Int)(implicit request: Request[_], messages: Messages)
@summary = @{
  calculatorResponse
}
@tabLabels = @{
  List(Messages("quick_calc.result.tabLabels.year"),
    Messages("quick_calc.result.tabLabels.month"),
    Messages("quick_calc.result.tabLabels.week"))
}

@breakdowns = @{
  List(
    summary.getYearly,
    summary.getMonthly,
    summary.getWeekly
  )
}

<ul>
@for((breakdown,label)<- breakdowns.zip(tabLabels)) {
  <li style="margin:0;" id="@{"tab-content-"+breakdown.getPayPeriod}"
  data-tab-content="@{breakdown.getPayPeriod}"
    class="@{"tab-content-"+breakdown.getPayPeriod}"
    aria-labelledby=@{breakdown.getPayPeriod}>
  <p class="tab-content__first">
    <div class="data govuk-box-highlight">
      <div class="transaction-banner--complete" style="text-align:center">
<p style="margin:10px 0 15px; text-align:center">@{s"${Messages("quick_calc.result.you_take_home")} $taxYear is"}</p>
  <span id="your-take-home-pay-@{label}" class="data-item bold-xlarge">£@{s"${moneyFormatter(breakdown.getTakeHome)} ${Messages("a")} ${label.toLowerCase}"}</span>
  </div>
  </div>
  <br>
  <p style="font-weight:normal">@{Messages("quick_calc.result.total_deductions.info")}</p>
  <table style="width:100%">
    <thead>
      <tr>
        <th colspan="2"><span style="display: none">@{Messages("quick_calc.result.total_deductions.info")}</span></th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td id="income-tax-key-@{label}"style="width:60%">@{
          if(summary.getTaxCode.contains('S')) Messages("quick_calc.result.income_tax_scottish")
          else Messages("quick_calc.result.income_tax")
        }</td>
        <td id="income-tax-value-@{label}">£@{moneyFormatter(extractIncomeTax(breakdown))}</td>
      </tr>
      <tr>
        <td id="national-insurance-key-@{label}" style="width:60%">@{Messages("quick_calc.result.your_national_insurance")}</td>
        <td id="national-insurance-value-@{label}">£@{moneyFormatter(breakdown.getEmployeesNI)}</td>
      </tr>
      <tr>
        <td id="total-deductions-key-@{label}" style="font-weight: 700; width:60%">@{Messages("quick_calc.result.deductions")}</td>
        <td id="total-deductions-value-@{label}" style="font-weight: 700">£@{moneyFormatter(breakdown.getTotalDeductions)}</td>
      </tr>
    </tbody>
  </table>
  <div class="form-group" style="margin-top:2em">
    <details id="details">
      <summary class="summary">@{Messages("quick_calc.result.how_we_calculated")}</summary>
      <div>
        <table style="width:100%">
          <thead>
            <tr>
              <th>
                <span class="visuallyhidden">Part of calculation</span>
              </th>
              <th>
                <span class="visuallyhidden">Amount</span>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>
              @Messages("quick_calc.result.how_we_calculated.you_earn_a")
              </td>
              <td id="gross-pay-@{label}">
                £@{moneyFormatter(breakdown.getWages)} @Messages("quick_calc.result.how_we_calculated.you_earn_b")
              </td>
            </tr>
            <tr>
              <td id="tax-free-key-@{label}" style="width:60%">@{
                if(summary.getTaxCode.contains('S')) Messages("quick_calc.result.tax_free_allowance_scottish")
                else Messages("quick_calc.result.tax_free_allowance")
              }
              </td>
              <td id="tax-free-value-@{label}">£@{
                moneyFormatter(breakdown.getTaxFree)
              }</td>
            </tr>
            <tr>
              <td id="taxable-pay-key-@{label}" style="font-weight: 700">@{Messages("quick_calc.result.taxable_pay")}</td>
              <td id="taxable-pay-value-@{label}" style="font-weight: 700">£@{
                moneyFormatter(if(breakdown.getWages - breakdown.getTaxFree < 0){
                 0
               }else{
                  breakdown.getWages - breakdown.getTaxFree
               })
              }</td>
            </tr>
          </tbody>
        </table>
      </div>
    </details>
  </div>
  <p>
  </p>
  </li>
}
</ul>